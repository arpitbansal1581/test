pip install fastapi uvicorn pandas matplotlib openpyxl


from fastapi import FastAPI, Response
from fastapi.responses import FileResponse
import pandas as pd
import matplotlib.pyplot as plt
import os

app = FastAPI()
DATA_FILE = "data.xlsx"
REGION_CHART = "region_chart.png"
DIVISION_CHART = "division_chart.png"

def generate_charts():
    if not os.path.exists(DATA_FILE):
        raise FileNotFoundError(f"{DATA_FILE} not found")

    df = pd.read_excel(DATA_FILE)

    # Region-wise count
    region_counts = df.groupby('region')['regid'].count().reset_index()
    region_counts.columns = ['Region', 'RegID Count']

    plt.figure(figsize=(8, 5))
    plt.bar(region_counts['Region'], region_counts['RegID Count'], color='skyblue')
    plt.title('RegID Count per Region')
    plt.xlabel('Region')
    plt.ylabel('Count')
    plt.grid(True, axis='y', linestyle='--', alpha=0.7)
    plt.tight_layout()
    plt.savefig(REGION_CHART)
    plt.close()

    # Division-wise count
    division_counts = df.groupby('division')['regid'].count().reset_index()
    division_counts.columns = ['Division', 'RegID Count']

    plt.figure(figsize=(8, 5))
    plt.bar(division_counts['Division'], division_counts['RegID Count'], color='lightgreen')
    plt.title('RegID Count per Division')
    plt.xlabel('Division')
    plt.ylabel('Count')
    plt.grid(True, axis='y', linestyle='--', alpha=0.7)
    plt.tight_layout()
    plt.savefig(DIVISION_CHART)
    plt.close()

@app.on_event("startup")
def startup_event():
    # Generate charts on startup
    generate_charts()

@app.get("/")
def root():
    return {"message": "Welcome to the RegID Chart API"}

@app.get("/chart/region")
def get_region_chart():
    if os.path.exists(REGION_CHART):
        return FileResponse(REGION_CHART, media_type="image/png")
    return Response(content="Region chart not found", status_code=404)

@app.get("/chart/division")
def get_division_chart():
    if os.path.exists(DIVISION_CHART):
        return FileResponse(DIVISION_CHART, media_type="image/png")
    return Response(content="Division chart not found", status_code=404)
